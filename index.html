const SHEET_ID = 'xxxxxxxxxxxx'; // 你的
const SHEET_NAME = '工作表1'; 
const TEMPLATE_DOC_ID = 'xxxxxxx'; 
const OUTPUT_FOLDER_ID = 'xxxxxxx';

function doPost(e) {
  const action = e.parameter.action;
  if (action === 'login') return handleLogin(e.parameter);
  if (action === 'changePassword') return handleChangePassword(e.parameter);
  if (action === 'generateSignedPdf') return generateSignedPdf(e.parameter);
  return ContentService.createTextOutput(JSON.stringify({ success: false, message: '未知的 action' }))
    .setMimeType(ContentService.MimeType.JSON);
}

function doGet(e) {
  const action = e.parameter.action;
  if (action === 'getFileList') {
    // e.parameter.folderId
    try {
      const folderId = e.parameter.folderId;
      const folder = DriveApp.getFolderById(folderId);
      const files = folder.getFiles();
      const result = [];

      while(files.hasNext()) {
        const file = files.next();
        const name = file.getName();
        
        // 簡易副檔名 => extension
        let ext = name.split('.').pop().toLowerCase();
        const mime = file.getMimeType();
        // 若是 Google Docs => ext = 'gdoc'
        if (mime === MimeType.GOOGLE_DOCS) {
          ext = 'gdoc';
        } else if(mime===MimeType.GOOGLE_SHEETS) {
          ext = 'gsheet';
        } 
        // 你可再加 else if(mime===MimeType.GOOGLE_PRESENTATION)...

        result.push({
          name,
          date: Utilities.formatDate(file.getDateCreated(), Session.getScriptTimeZone(), 'yyyy/MM/dd HH:mm'),
          extension: ext
        });
      }

      return ContentService.createTextOutput(
        JSON.stringify({ success: true, files: result })
      ).setMimeType(ContentService.MimeType.JSON);
    } catch(e) {
      return ContentService.createTextOutput(
        JSON.stringify({ success: false, message: e.message })
      ).setMimeType(ContentService.MimeType.JSON);
    }
  }

  // 其餘 ...
  return ContentService.createTextOutput(JSON.stringify({ success: false, message: 'No valid action.' }))
    .setMimeType(ContentService.MimeType.JSON);
}

// 其它 handleLogin/handleChangePassword/generateSignedPdf 與之前保持不變。 
// 例如 handleLogin => 7欄位: [id, empName, dept, title, pw, folderId, rawFirstLogin] ...
// 這裡略
function handleLogin(params) {
  // ...
  // 只要確保跟你Sheet對應就好
}

function handleChangePassword(params) {
  // ...
}

function generateSignedPdf(params) {
  // ...
  // 不變
}
